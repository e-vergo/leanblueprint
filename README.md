# leanblueprint

**leanblueprint** is a [plasTeX](https://github.com/plastex/plastex/) plugin for creating interactive mathematical blueprints for Lean 4 projects. It consumes artifacts from [Dress](https://github.com/e-vergo/Dress) to produce websites with syntax-highlighted Lean code, hover tooltips, expandable proofs, and dependency graphs.

## Architecture

leanblueprint is the **presentation layer** in the blueprint toolchain:

```
┌─────────────────────────────────────────────────────────────────────┐
│                     YOUR LEAN PROJECT                               │
│  import Dress                                                       │
│  @[blueprint "thm:foo"] theorem foo : ... := ...                   │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              │ lake build (with marker file)
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         DRESS                                       │
│  Generates artifacts during Lean elaboration:                       │
│  • .lake/build/dressed/{Module/Path}/module.json (highlighting)     │
│  • .lake/build/dressed/{Module/Path}/module.tex (LaTeX + hover)     │
│  • .lake/build/dressed/{Module/Path}/{label}/decl.{tex,html,json}   │
│  • .lake/build/dressed/library/{Library}.tex (index)                │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              │ Consumes artifacts
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    LEANBLUEPRINT (this tool)                        │
│                                                                     │
│  • Parses LaTeX with embedded base64 HTML/JSON                      │
│  • Renders interactive web pages with:                              │
│    - Syntax-highlighted Lean code                                   │
│    - Hover tooltips showing types                                   │
│    - Expandable/collapsible proofs                                  │
│    - Dependency graph visualization                                 │
│  • Generates PDF via LaTeX compilation                              │
└─────────────────────────────────────────────────────────────────────┘
```

## Features

### Side-by-Side Display

Renders Lean code alongside LaTeX theorem statements:

- **Pre-rendered HTML** — Dress embeds base64-encoded HTML directly in `.tex` files
- **Semantic highlighting** — CSS classes for Lean tokens: keywords, constants, variables, strings, docstrings, sorts
- **Hover tooltips** — Type information displayed on mouseover
- **Proof toggle** — Expand/collapse proof bodies independently
- **Rainbow brackets** — 6-color depth cycling for matching brackets

### Dependency Graph

Interactive SVG graph showing:
- Node states: stated, proved, not ready, defined, fully proved
- Clickable nodes linking to declarations
- Color-coded by formalization status

## Installation

### Prerequisites

graphviz and its development libraries:

```bash
# Ubuntu/Debian
sudo apt install graphviz libgraphviz-dev

# macOS
brew install graphviz
```

### Install leanblueprint

```bash
pip install leanblueprint
```

Or install from this fork for side-by-side display:

```bash
pip install git+https://github.com/e-vergo/leanblueprint.git
```

## Quick Start

### 1. Set up your Lean project with Dress

Add to `lakefile.toml`:

```toml
[[require]]
name = "Dress"
git = "https://github.com/e-vergo/Dress"
rev = "main"
```

### 2. Mark declarations with `@[blueprint]`

```lean
import Dress

@[blueprint "thm:my-theorem"]
theorem myTheorem : 2 + 2 = 4 := rfl
```

### 3. Create blueprint structure

```bash
leanblueprint new
```

### 4. Build artifacts and blueprint

```bash
# Generate Dress artifacts
mkdir -p .lake/build
echo "1" > .lake/build/.dress
lake build
rm .lake/build/.dress

# Generate library index
lake build :blueprint

# Build website and PDF
cd blueprint
leanblueprint pdf
leanblueprint web
leanblueprint serve  # View at http://localhost:8000
```

## Commands

| Command | Description |
|---------|-------------|
| `leanblueprint new` | Create blueprint structure for a Lean project |
| `leanblueprint pdf` | Build PDF (requires TeX installation) |
| `leanblueprint web` | Build HTML website |
| `leanblueprint serve` | Start local server to view blueprint |
| `leanblueprint checkdecls` | Verify Lean declarations exist |
| `leanblueprint all` | Run pdf, web, and checkdecls |

## LaTeX Macros

### From Dress Artifacts

These macros are automatically generated by Dress and should not be written manually:

| Macro | Purpose |
|-------|---------|
| `\leansourcehtml{base64}` | Pre-rendered HTML for full code |
| `\leansignaturesourcehtml{base64}` | Pre-rendered HTML for signature |
| `\leanproofsourcehtml{base64}` | Pre-rendered HTML for proof body |
| `\leanhoverdata{base64}` | Hover tooltip data (JSON) |
| `\leansource{base64}` | SubVerso JSON (fallback) |

### Manual Macros

For declarations not using Dress, or for additional annotations:

| Macro | Purpose |
|-------|---------|
| `\lean{name}` | Link to Lean declaration |
| `\leanok` | Mark as fully formalized |
| `\uses{label1, label2}` | Declare dependencies |
| `\notready` | Mark as not ready for formalization |
| `\discussion{issue_number}` | Link to GitHub issue |
| `\proves{label}` | Link proof to statement (when separated) |
| `\mathlibok` | Mark as merged into Mathlib |

### Including Dress Output

```latex
% Include library index (required for \inputleanmodule to work)
\input{../../.lake/build/dressed/library/MyProject.tex}

% Include entire module
\inputleanmodule{MyProject.MyModule}

% Include single declaration
\inputleannode{thm:my-theorem}
```

## Blueprint Configuration

In `blueprint/src/web.tex`:

```latex
\documentclass{report}
\usepackage[
  showmore,           % Enable expand/collapse
  dep_graph,          % Enable dependency graph
  coverage,           % Show coverage stats
  project=../../,     % Path to Lean project root
  thms=definition+lemma+proposition+theorem+corollary
]{blueprint}

\home{https://example.github.io/myproject/}
\github{https://github.com/example/myproject}
\dochome{https://example.github.io/myproject/docs}

\input{blueprint.tex}
\end{document}
```

### Graph Colors

Customize dependency graph colors:

```latex
\graphcolor{proved}{#9CEC8B}{Proved}
\graphcolor{stated}{green}{Stated}
\graphcolor{not_ready}{#FFAA33}{Not ready}
```

## CSS Classes

For custom styling of Lean code:

| Class | Element |
|-------|---------|
| `lean-keyword` | `theorem`, `def`, `by`, etc. |
| `lean-const` | Constants and definitions |
| `lean-var` | Variables and parameters |
| `lean-string` | String literals |
| `lean-docstring` | Documentation comments |
| `lean-comment` | Regular comments |
| `lean-number` | Numeric literals |
| `lean-operator` | Mathematical operators |
| `lean-bracket-1` through `lean-bracket-6` | Rainbow brackets |

## GitHub Actions

Add to your workflow:

```yaml
- name: Build blueprint
  run: |
    mkdir -p .lake/build
    echo "1" > .lake/build/.dress
    lake build
    rm .lake/build/.dress
    lake build :blueprint
    cd blueprint
    leanblueprint pdf
    leanblueprint web
```

## Example Projects

Projects using leanblueprint:

- [Sphere Eversion Project](https://leanprover-community.github.io/sphere-eversion/blueprint/)
- [Polynomial Freiman-Ruzsa Conjecture](https://teorth.github.io/pfr/blueprint/)
- [Fermat's Last Theorem](https://imperialcollegelondon.github.io/FLT/blueprint/)
- [Prime Number Theorem](https://alexkontorovich.github.io/PrimeNumberTheoremAnd/web/)

See the full list in the [upstream README](https://github.com/PatrickMassot/leanblueprint).

## Related Projects

- **[Dress](https://github.com/e-vergo/Dress)** — Artifact generator (required for side-by-side display)
- **[LeanArchitect](https://github.com/e-vergo/LeanArchitect)** — `@[blueprint]` attribute (included in Dress)
- **[Original leanblueprint](https://github.com/PatrickMassot/leanblueprint)** — Upstream project

## License

Apache 2.0 — see [LICENSE](LICENSE) for details.

## Acknowledgments

Based on [PatrickMassot/leanblueprint](https://github.com/PatrickMassot/leanblueprint). The original infrastructure was created for the [Sphere Eversion Project](https://leanprover-community.github.io/sphere-eversion/) and has been used by many formalization projects since.
